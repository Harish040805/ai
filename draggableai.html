<div id="ai-widget" style="position:relative; width:100%; height:100%;">
  <button id="dragBtn" style="position:absolute; top:90%; left:5%; transform:translate(-50%,-50%);
    padding:20px 24px; background-color:#0077cc; color:white; border:5px solid white; border-radius:50%; cursor:grab;
    font-size:20px; font-weight:bold; box-shadow:0 4px 8px rgba(0,0,0,0.2); user-select:none; z-index:1000;">AI</button>
  <iframe id="myIframe" style="position:fixed; top:0; right:0; width:20vw; height:100vh; border:none; background:#fff; box-shadow:-4px 0 12px rgba(0,0,0,0.2); 
  display:none; z-index:999;"
    srcdoc="
<!DOCTYPE html>
<html>
<head>
<style>
  body { margin:0; font-family:Arial,sans-serif; background:#fff; display:flex; flex-direction:column; height:100%; }
  #header { position:relative; background:#0077cc; color:white; text-align:center; padding:12px; font-weight:bold; font-size:18px; }
  #closeBtn { position:absolute; top:10px; right:10px; padding:6px 12px; background:#ff0000; color:white; border:none; border-radius:6px; cursor:pointer; 
  font-weight:bold; font-size:14px; box-shadow:0 2px 6px rgba(0,0,0,0.2); }
  #closeBtn:hover { color:#ccc; }
  #content { flex:1; padding:10px; display:flex; flex-direction:column; gap:10px; }
  input[type=text] { width:90%; padding:8px; font-size:14px; border:1px solid #ccc; border-radius:6px; }
  button.askBtn { padding:8px; background:#0077cc; color:white; border:none; border-radius:6px; font-weight:bold; cursor:pointer; }
  button.askBtn:hover { background:#005fa3; }
  #response { margin-top:10px; font-size:14px; color:#333; overflow-y:auto; max-height:70%; border-top:1px solid #ccc; padding-top:8px; }
</style>
</head>
<body>
  <div id='header'>Ask AI <button id='closeBtn'>X</button></div>
  <div id='content'>
    <input type='text' id='userInput' placeholder='Type your question...' />
    <button class='askBtn' id='askBtn'>Ask AI</button>
    <div id='response'>Response will appear here...</div>
  </div>
<script>
  const askBtn = document.getElementById('askBtn');
  const responseDiv = document.getElementById('response');
  const userInput = document.getElementById('userInput');
  const closeBtn = document.getElementById('closeBtn');
  closeBtn.addEventListener('click', ()=> parent.postMessage('closeIframe','*'));
  askBtn.addEventListener('click', async ()=> {
    const question = userInput.value.trim();
    if(!question){ responseDiv.innerHTML='<span style=color:red;>Please enter a question.</span>'; return; }
    responseDiv.innerHTML='<em>Thinking...</em>';
    try {
      const res = await fetch('https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=AIzaSyC5ab-HZmvtoTEXMRBMb4-tPpwD2yMVF1A',{
        method:'POST', headers:{'Content-Type':'application/json'},
        body:JSON.stringify({contents:[{parts:[{text:question}]}]})
      });
      const data = await res.json();
      responseDiv.textContent = data?.candidates?.[0]?.content?.parts?.[0]?.text || 'No response from AI.';
    } catch(e){ responseDiv.textContent='Error: '+e.message; }
  });
</script>
</body>
</html>
"></iframe>
  <script>
    const dragBtn=document.getElementById('dragBtn');
    const iframe=document.getElementById('myIframe');
    let isDragging=false, dragStartX=0, dragStartY=0, offsetX=0, offsetY=0;
    dragBtn.addEventListener('click', ()=> { if(!isDragging){ iframe.style.display='block'; dragBtn.style.display='none'; }});
    window.addEventListener('message',(e)=>{ if(e.data==='closeIframe'){ iframe.style.display='none'; dragBtn.style.display='block'; }});
    const startDrag=(e)=>{ e.preventDefault(); isDragging=false;
      dragStartX=e.type==='touchstart'?e.touches[0].clientX:e.clientX;
      dragStartY=e.type==='touchstart'?e.touches[0].clientY:e.clientY;
      offsetX=dragBtn.offsetLeft; offsetY=dragBtn.offsetTop;
      document.addEventListener('mousemove',dragMove); document.addEventListener('mouseup',stopDrag);
      document.addEventListener('touchmove',dragMove,{passive:false}); document.addEventListener('touchend',stopDrag);
    };
    const dragMove=(e)=>{ e.preventDefault();
      const clientX=e.type.startsWith('touch')?e.touches[0].clientX:e.clientX;
      const clientY=e.type.startsWith('touch')?e.touches[0].clientY:e.clientY;
      const deltaX=clientX-dragStartX; const deltaY=clientY-dragStartY;
      if(Math.abs(deltaX)>5||Math.abs(deltaY)>5){ isDragging=true; }
      if(isDragging){
        let newX=offsetX+deltaX; let newY=offsetY+deltaY;
        const maxX=window.innerWidth-dragBtn.offsetWidth;
        const maxY=window.innerHeight-dragBtn.offsetHeight;
        newX=Math.max(0,Math.min(newX,maxX)); newY=Math.max(0,Math.min(newY,maxY));
        dragBtn.style.left=newX+'px'; dragBtn.style.top=newY+'px';
      }
    };
    const stopDrag=()=>{ document.removeEventListener('mousemove',dragMove);
      document.removeEventListener('mouseup',stopDrag);
      document.removeEventListener('touchmove',dragMove);
      document.removeEventListener('touchend',stopDrag);
    };
    dragBtn.addEventListener('mousedown',startDrag);
    dragBtn.addEventListener('touchstart',startDrag,{passive:false});
  </script>
</div>
