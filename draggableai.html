<!-- ✅ Draggable AI Button -->
<div id="newton-drag-container">
  <button id="newton-drag-btn">Ask AI</button>
</div>

<!-- ✅ Popup Iframe (Initially Hidden) -->
<iframe id="newton-chat-iframe" style="display:none;"></iframe>

<style>
/* Draggable Button */
#newton-drag-container {
  position: fixed;
  bottom: 20px;
  right: 20px;
  z-index: 9999;
}
#newton-drag-btn {
  background-color: #007bff;
  color: #fff;
  border: none;
  padding: 12px 18px;
  border-radius: 50px;
  font-size: 16px;
  cursor: pointer;
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}

/* Popup Iframe */
#newton-chat-iframe {
  position: fixed;
  bottom: 80px;
  right: 20px;
  width: 350px;
  height: 450px;
  border: none;
  border-radius: 12px;
  box-shadow: 0 8px 16px rgba(0,0,0,0.3);
  z-index: 10000;
  background: white;
}
@media (max-width: 500px) {
  #newton-chat-iframe {
    width: 90%;
    height: 60%;
    bottom: 70px;
    right: 5%;
  }
}
</style>

<script>
/* ✅ Draggable Button Logic */
(function(){
  const newtonBtn = document.getElementById('newton-drag-btn');
  const newtonContainer = document.getElementById('newton-drag-container');
  let newtonOffsetX, newtonOffsetY, newtonDragging = false;

  newtonBtn.addEventListener('mousedown', (e) => {
    newtonDragging = true;
    newtonOffsetX = e.clientX - newtonContainer.offsetLeft;
    newtonOffsetY = e.clientY - newtonContainer.offsetTop;
  });

  document.addEventListener('mousemove', (e) => {
    if(newtonDragging){
      newtonContainer.style.left = (e.clientX - newtonOffsetX) + 'px';
      newtonContainer.style.top = (e.clientY - newtonOffsetY) + 'px';
      newtonContainer.style.position = 'fixed';
    }
  });

  document.addEventListener('mouseup', () => newtonDragging = false);

  /* ✅ Toggle Chat Iframe */
  newtonBtn.addEventListener('click', () => {
    const iframe = document.getElementById('newton-chat-iframe');
    iframe.style.display = (iframe.style.display === 'none' ? 'block' : 'none');
  });

  /* ✅ Inject Chat UI into Iframe */
  const newtonIframe = document.getElementById('newton-chat-iframe');
  newtonIframe.srcdoc = `
  <!DOCTYPE html>
  <html>
  <head>
    <style>
      body { font-family: Arial, sans-serif; margin:0; padding:10px; }
      #newton-chat-box { height: 350px; overflow-y: auto; border:1px solid #ccc; padding:10px; border-radius:8px; margin-bottom:10px; }
      #newton-input { width: 70%; padding:8px; }
      #newton-send { padding:8px 12px; background:#007bff; color:white; border:none; border-radius:6px; cursor:pointer; }
      p { margin: 5px 0; }
    </style>
  </head>
  <body>
    <div id="newton-chat-box"></div>
    <input type="text" id="newton-input" placeholder="Ask me anything..." />
    <button id="newton-send">Send</button>
    <script>
      const newtonChat = document.getElementById('newton-chat-box');
      const newtonInput = document.getElementById('newton-input');
      const newtonSend = document.getElementById('newton-send');

      newtonSend.addEventListener('click', async () => {
        const message = newtonInput.value.trim();
        if(!message) return;
        newtonChat.innerHTML += '<p><b>You:</b> ' + message + '</p>';
        newtonInput.value = '';
        newtonChat.scrollTop = newtonChat.scrollHeight;

        // ✅ Call Gemini API
        try {
          const response = await fetch("https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=YOUR_API_KEY", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ contents: [{ parts: [{ text: message }] }] })
          });
          const data = await response.json();
          let aiReply = "Sorry, I couldn't generate a response.";
          if(data && data.candidates && data.candidates.length > 0) {
            aiReply = data.candidates[0].content.parts[0].text;
          }
          newtonChat.innerHTML += '<p><b>AI:</b> ' + aiReply + '</p>';
          newtonChat.scrollTop = newtonChat.scrollHeight;
        } catch (error) {
          newtonChat.innerHTML += '<p><b>AI:</b> Error connecting to AI.</p>';
        }
      });
    </script>
  </body>
  </html>
  `;
})();
</script>
